DROP TABLE HORASEXTRA CASCADE CONSTRAINTS;
DROP TABLE LINEA CASCADE CONSTRAINTS;
DROP TABLE PARTESTRABAJO CASCADE CONSTRAINTS;
DROP TABLE ALBARAN CASCADE CONSTRAINTS;
DROP TABLE VEHICULO CASCADE CONSTRAINTS;
DROP TABLE USUARIOBD CASCADE CONSTRAINTS;
DROP TABLE TRABAJADOR CASCADE CONSTRAINTS;
DROP TABLE CENTROTRABAJO CASCADE CONSTRAINTS;

CREATE TABLE CENTROTRABAJO (
ID NUMBER(3),
NOMBRE VARCHAR2(20),
CALLE VARCHAR2(35),
NUMERO VARCHAR2(3),
COD_POSTAL VARCHAR2(5),
CIUDAD VARCHAR2(20),
PROVINCIA VARCHAR2(20),
TELEFONO VARCHAR2(9),
CONSTRAINT CTR_ID_PK PRIMARY KEY(ID)
);

CREATE TABLE TRABAJADOR (
DNI VARCHAR2(9),
NOMBRE VARCHAR2(15),
APELLIDO1 VARCHAR2(15),
APELLIDO2 VARCHAR2(15),
CALLE VARCHAR2(35),
PORTAL VARCHAR2(3),
PISO VARCHAR2(2),
MANO VARCHAR2(2),
TEL_EMPRESA VARCHAR2(9),
TEL_PERSONAL VARCHAR2(9) NULL,
FECHA_NAC DATE NULL,
SALARIO NUMBER(6,2) NULL,
ID NUMBER(3),
CONSTRAINT TRA_DNI_PK PRIMARY KEY(DNI),
CONSTRAINT TRA_ID_FK FOREIGN KEY(ID) REFERENCES CENTROTRABAJO
);

CREATE TABLE USUARIOBD(
USERNAME Varchar2(30),
CONTRASEÃ‘A Varchar2(20),
DNI_TRAB Varchar2(9),    
CONSTRAINT user_pk PRIMARY KEY (USERNAME),
CONSTRAINT dni_fk FOREIGN KEY  (DNI_TRAB) REFERENCES trabajador
);



CREATE TABLE VEHICULO (
MATRICULA VARCHAR2(8),
MODELO VARCHAR2(15),
MARCA VARCHAR2(15),
CONSTRAINT VEH_MAT_PK PRIMARY KEY(MATRICULA)
);

CREATE TABLE ALBARAN (
NUM_ALBARAN NUMBER(10),
/*ORIGEN VARCHAR2(70),
DESTINO VARCHAR2(70),
MATERIAL VARCHAR2(15) NULL,
BRUTO NUMBER(5,2) NULL,
NETO NUMBER(5,2) NULL,
CONTENEDOR VARCHAR2(10) NULL,*/
CONSTRAINT ALB_NUA_PK PRIMARY KEY(NUM_ALBARAN)
);

CREATE TABLE PARTESTRABAJO (
NUM_PARTE NUMBER(6),
KM_INICIO NUMBER(6),
KM_FINAL NUMBER(6),
GASTOS_GASOIL NUMBER(5) NULL,
GASTOS_PEAJES NUMBER(5) NULL,
GASTOS_DIETAS NUMBER(5) NULL,
OTROS_GASTOS NUMBER(5) NULL,
INCIDENCIAS VARCHAR2(250) NULL,
DNI_ADMIN VARCHAR2(9) NULL,
DNI_LOGIS VARCHAR2(9),
CONSTRAINT PAT_NUP_PK PRIMARY KEY(NUM_PARTE),
CONSTRAINT PAT_ADM_FK FOREIGN KEY(DNI_ADMIN) REFERENCES TRABAJADOR,
CONSTRAINT PAT_LOG_FK FOREIGN KEY(DNI_LOGIS) REFERENCES TRABAJADOR
);

CREATE TABLE LINEA (
ID NUMBER(10),
HORA_SALIDA TIMESTAMP,
HORA_LLEGADA TIMESTAMP,
MATRICULA VARCHAR2(8),
NUM_PARTE NUMBER(6),
NUM_ALBARAN NUMBER(10),
CONSTRAINT LIN_ID_PK PRIMARY KEY(ID),
CONSTRAINT LIN_NUP_FK FOREIGN KEY(NUM_PARTE) REFERENCES PARTESTRABAJO,
CONSTRAINT LIN_MAT_FK FOREIGN KEY(MATRICULA) REFERENCES VEHICULO,
CONSTRAINT LIN_NUA_FK FOREIGN KEY(NUM_ALBARAN) REFERENCES ALBARAN
);

CREATE TABLE HORASEXTRA(
HORAS_EXTRA NUMBER(4),
CONSTRAINT HE_HE_PK PRIMARY KEY(HORAS_EXTRA)
);

ALTER TABLE CENTROTRABAJO
ADD CONSTRAINT CTR_CP_CK CHECK (COD_POSTAL > 0 OR COD_POSTAL < 99999);

ALTER TABLE TRABAJADOR
ADD TIPO VARCHAR2(1);

ALTER TABLE TRABAJADOR
ADD CONSTRAINT TRA_TIP_CK CHECK (TIPO IN ('L', 'A'));

ALTER TABLE TRABAJADOR
ADD CONSTRAINT TRA_POR_CK CHECK (PORTAL > 0 OR PORTAL < 999);

ALTER TABLE TRABAJADOR
ADD CONSTRAINT TRA_PIS_CK CHECK (PISO > 0 OR PISO < 99);

ALTER TABLE PARTESTRABAJO
ADD CONSTRAINT PAT_KMF_CK CHECK (KM_FINAL > KM_INICIO);

ALTER TABLE LINEA
ADD CONSTRAINT LIN_HLL_CK CHECK (HORA_LLEGADA > HORA_SALIDA);

ALTER TABLE LINEA
DROP COLUMN MATRICULA;

ALTER TABLE PARTESTRABAJO
ADD MATRICULA VARCHAR2(8);

DESC LINEA;
DESC PARTESTRABAJO;
INSERT INTO TRABAJADOR VALUES('11111111A','Admin', 'Admin', 'Admin', '' , '', '' , '', '', '' , '', '', '', 'A');
INSERT INTO USUARIOBD VALUES('admin', 'admin', '11111111A');

